#!/usr/bin/env node

require('dotenv').config();

require('../db');

const jobQueue = require('../lib/jobQueue');
const io = require('../io');

const socket = require('socket.io-client')(process.env.WEBSOCKET_URL);
socket.on('connect', () => {
    // listen to events in the render room
    socket.emit('registerRenderServer', socket.id);
    console.log('Connected to Web...');
});

socket.on('disconnect', () => {
    console.log('Disconnected from web...');
})

socket.on('createJob', (data) => {
    if (data.projectType == 'project') {
        jobQueue.addProject(data.project, data.socketId);
    }

    if (data.projectType == 'preview') {
        jobQueue.addPreview(data.project, data.socketId);
    }
});

io(socket);
